# 居住支援記録システム (Anshin House Daily Log)

居住支援事業者向けの、**プロアクティブ（予防的）な利用者ケア**を実現するための、モダンな活動記録・タスク管理システムです。
ITスキルに自信のないスタッフでも直感的に使えるシンプルなUIと、データに基づいた意思決定を支援する高度な機能を両立。支援の抜け漏れを撲滅し、チーム全体の業務効率を最大化することを目的とします。

このシステムは、利用者の基本情報を管理する**利用者マスターDB (`anshinhousedb`)**と連携して動作します。

---

## 🚀 主要機能

### 📊 インテリジェント・ダッシュボード
- **チームのToDoリスト**: ログインすると、まずチーム全体の**「未完了タスク」**が期限の近い順に表示されます。これにより、「今日やるべきこと」を即座に把握できます。
- **インタラクティブなタスク管理**: 各タスクにその場で**担当者を割り当て**たり、ワンクリックで**完了**させたりすることが可能です。
- **リアルタイム・ケア状況**: 最終接触からの経過日数を常に監視し、90日以上未接触の**要注意利用者**を自動でハイライトします。
- **活動分析ビュー**: タブを切り替えるだけで、**「今月」「先月」「過去3ヶ月」**の期間で、チームの活動状況をグラフで可視化できます。
  - スタッフ別の**活動件数**と**合計活動時間**（業務負荷の把握）
  - 活動種別の**件数割合**と**時間割合**（業務内容の分析）
- **ミニカレンダー**: 月全体の活動・タスク状況を鳥瞰できるコンパクトなカレンダーを統合しています。

### 📝 記録・タスクの統合管理
- **デュアルモード入力フォーム**: 1つの画面で、「**実施済みの活動（実績）**」と「**未来に行うべきこと（タスク）**」を明確に区別して登録できます。
- **活動時間の記録**: 活動の「開始・終了時間」またはタスクの「希望時間」を任意で記録でき、正確な業務分析の基盤を築きます。

### 📅 多機能カレンダー
- **3つの時間軸の可視化**: **「実績（完了済み）」「タスク（期限内）」「タスク（期限切れ）」**を、緑・黄・赤の色で明確に区別して表示する、強力な作戦司令室です。
- **表示モード切替**: 「すべて」「実績のみ」「要対応（未完了タスク）のみ」といった表示フィルターをワンクリックで切り替え、目的に応じて情報を絞り込めます。
- **インタラクティブな詳細表示**: カレンダー上の任意のアイテムをクリックすると、その日のすべての活動とタスクの詳細をモーダルウィンドウで確認できます。

### 👥 利用者詳細
- **タスクと履歴の分離**: 各利用者の**「未完了タスク」**と**「完了済みの活動履歴」**が明確に分けて表示され、状況を正確に把握できます。
- **アクション起点**: 各タスクや記録に対して、**「完了」「編集」「削除（安全確認付き）」**といった操作を直接行えます。
- **活動時間の表示**: 各活動記録には、記録された**開始・終了時間**と、自動計算された**所要時間（分）**が表示されます。

### ⚙️ マスタデータ管理
- **スタッフ管理**: アプリケーションを利用するスタッフの情報を管理します。
- **活動種別管理**: 「訪問」「電話」などの活動の種類を自由に設定できます。

---

## 🛠️ 技術スタック

- **フレームワーク**: Next.js 14 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **UIコンポーネント**: shadcn/ui
- **データベース**: Supabase (PostgreSQL + Auth)
- **デプロイ**: Vercel
- **連携先API**: `anshinhousedb` (Next.jsで構築された利用者マスターDB)

---

## 📦 セットアップ（開発環境）

### 1. 依存関係
このプロジェクトは、**`anshinhousedb`**プロジェクトに依存しています。まず、`anshinhousedb`をローカルでセットアップし、開発サーバーを起動してください（通常は`localhost:3001`で動作）。

### 2. リポジトリのクローン

git clone <repository-url>
cd anshin-house-daily-log

### 3. 依存関係のインストール
このプロジェクトはpnpmを使用しています。

### 4. 環境変数の設定
プロジェクトルートに.env.localファイルを作成し、以下の内容を設定してください。
# SupabaseプロジェクトのURLとAnon Key
NEXT_PUBLIC_SUPABASE_URL=https://your-daily-log-project-id.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# 連携先の利用者マスターDBアプリの情報
NEXT_PUBLIC_MASTER_DB_API_URL=http://localhost:3001 # ローカルのanshinhousedbのURL
NEXT_PUBLIC_MASTER_DB_URL=http://localhost:3002 # ローカルのanshinhousedbのフロントエンドURL（あれば）
NEXT_PUBLIC_MASTER_DB_API_KEY=your_master_db_api_secret_key # anshinhousedb側で設定したAPIキー

### 5. Supabaseの設定
a. データベーステーブルの作成
scripts/01-create-tables.sqlのSQLを、Supabase管理画面のSQL Editorで実行してテーブルを作成します。（注意: DROP TABLE命令は、既存のデータを削除します）
b. RLSポリシーの設定
scripts/02-rls-policies.sql（またはそれに類するファイル）のSQLをSQL Editorで実行し、行単位セキュリティを設定します。
c. 型定義の生成
データベースのスキーマを変更した場合は、必ず以下のコマンドを実行してTypeScriptの型を更新してください。

pnpm dlx supabase gen types typescript --linked > lib/database.types.ts

### 6. 開発サーバーの起動
anshinhousedbがlocalhost:3001で起動していることを確認してから、以下のコマンドを実行します。

pnpm run dev

## 📋 基本的な運用フロー
初期設定: [設定]ページから、スタッフ情報と活動種別を登録します。
日常業務:
電話などで支援依頼を受けたら、[記録追加]ページで**「タスクの登録」**を行います。
ダッシュボードの**「チームのToDoリスト」**で未完了タスクを確認し、担当者を割り当てます。
タスクが完了したら、ダッシュボードまたは利用者詳細ページで**「完了」**ボタンを押します。
完了した活動は、[記録追加]ページで**「活動の記録」**として詳細を入力します。
定期確認:
ダッシュボードの「利用者一覧」で、長期間接触のない要注意利用者がいないかを確認します。
「活動分析」タブでチームの業務負荷や活動傾向を定期的にレビューし、業務改善に役立てます。